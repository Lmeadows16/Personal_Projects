<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Screen Repair Form</title>
  <style>
    body { text-align: center; font-family: Arial, sans-serif; background-color: #f9f9f9; margin: 0; padding: 2rem; }
    .container { margin: 0 auto; max-width: 600px; text-align: left; background: #fff; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; }
    header { text-align: center; margin-bottom: 1.5rem; }
    header img { max-height: 80px; margin: 0 auto 0.5rem; display: block; }
    h1, h2 { margin: 0; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #999; border-radius: 4px; box-sizing: border-box; }
    textarea { resize: vertical; height: 100px; }
    .screen-group { border: 1px dashed #aaa; padding: 1rem; margin-top: 1rem; border-radius: 4px; position: relative; }
    .remove-btn { position: absolute; top: 8px; right: 8px; background: #dc3545; color: #fff; border: none; padding: 0.25rem 0.5rem; cursor: pointer; border-radius: 4px; }
    .price-display { margin-top: 0.5rem; font-weight: bold; }
    #add-screen { margin-top: 1rem; padding: 0.5rem 1rem; font-size: 0.9rem; cursor: pointer; }
    .summary { margin-top: 1.5rem; padding: 1rem; border: 1px solid #ccc; border-radius: 4px; background: #fff; }
    .summary p { margin: 0.5rem 0; font-weight: bold; }
    button[type="submit"] { margin: 1.5rem auto 0; padding: 0.75rem 1.5rem; font-size: 1rem; border: none; border-radius: 4px; cursor: pointer; background-color: #007bff; color: white; display: block; }
    button[type="submit"]:hover { background-color: #0056b3; }
    .output-container { margin: 2rem auto; max-width: 600px; text-align: left; background: #fff; padding: 1rem; border: 2px solid #333; border-radius: 6px; }
    .output-container p.thanks { text-align: center; font-style: italic; margin-top: 1rem; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 0.75rem; border-bottom: 1px solid #ccc; }
    th { background: #f2f2f2; width: 35%; }
    tr:last-child td { border-bottom: none; }
  </style>
</head>
<body>
  <div class="container">
    <header><img src="ace-logo.png" alt="ACE Logo"><h1>Screen Repair Form</h1></header>
    <form id="repairForm">
      <label for="repair-date">Date</label>
      <input type="date" id="repair-date" name="date" required>
      <label for="customer-name">Customer Full Name</label>
      <input type="text" id="customer-name" name="customerName" required>
      <label for="phone-number">Phone Number</label>
      <input type="tel" id="phone-number" name="phoneNumber" required>

      <div id="screens-container">
        <div class="screen-group" id="screen-template">
          <button type="button" class="remove-btn">Ã—</button>
          <label>Screen Width (inches)</label>
          <input type="number" name="screenWidth" min="0" step="0.1" required>
          <label>Screen Height (inches)</label>
          <input type="number" name="screenHeight" min="0" step="0.1" required>
          <label>Quantity</label>
          <input type="number" name="quantity" min="1" step="1" required>
          <label>Material</label>
          <select name="material" required>
            <option>Silver Fiber</option>
            <option>Black Fiber</option>
            <option>Silver Aluminum</option>
            <option>Black Aluminum</option>
            <option>Pet Screen</option>
            <option>SS Glass</option>
            <option>DS Glass</option>
            <option>Plexiglass</option>
          </select>
          <div class="price-display unit-price">Unit: $0.00</div>
          <div class="price-display total-price">Total: $0.00</div>
        </div>
      </div>

      <button type="button" id="add-screen">Add Another Screen</button>
      <label for="notes">Notes</label>
      <textarea id="notes" name="notes"></textarea>
      <div class="summary">
        <p id="summary-quantity">Total Screens: 0</p>
        <p id="summary-screen-total">Screen Total: $0.00</p>
        <p id="summary-labor">Labor Charge: $0.00</p>
        <p id="summary-tax">Tax: $0.00</p>
        <p id="summary-grand">Grand Total: $0.00</p>
      </div>
      <button type="submit">Generate Form</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const TAX_RATE = 0.1025;
      const SET_SIZES = [
        { w: 24, h: 30, labor: 20, prices: { 'Silver Fiber': 10, 'Black Fiber': 10, 'Silver Aluminum': 13, 'Black Aluminum': 13, 'Pet Screen': 18, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 24, h: 36, labor: 20, prices: { 'Silver Fiber': 12, 'Black Fiber': 12, 'Silver Aluminum': 18, 'Black Aluminum': 18, 'Pet Screen': 20, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 30, h: 30, labor: 20, prices: { 'Silver Fiber': 13, 'Black Fiber': 13, 'Silver Aluminum': 18, 'Black Aluminum': 18, 'Pet Screen': 23, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 30, h: 36, labor: 20, prices: { 'Silver Fiber': 13, 'Black Fiber': 10, 'Silver Aluminum': 18, 'Black Aluminum': 18, 'Pet Screen': 21, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 30, h: 42, labor: 20, prices: { 'Silver Fiber': 14, 'Black Fiber': 14, 'Silver Aluminum': 20, 'Black Aluminum': 20, 'Pet Screen': 26, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 36, h: 48, labor: 20, prices: { 'Silver Fiber': 17, 'Black Fiber': 17, 'Silver Aluminum': 24, 'Black Aluminum': 24, 'Pet Screen': 27, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 48, h: 48, labor: 30, prices: { 'Silver Fiber': 17, 'Black Fiber': 17, 'Silver Aluminum': 24, 'Black Aluminum': 24, 'Pet Screen': 32, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 36, h: 78, labor: 30, prices: { 'Silver Fiber': 21, 'Black Fiber': 21, 'Silver Aluminum': 31, 'Black Aluminum': 31, 'Pet Screen': 42, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } },
        { w: 48, h: 72, labor: 30, prices: { 'Silver Fiber': 10, 'Black Fiber': 10, 'Silver Aluminum': 13, 'Black Aluminum': 13, 'Pet Screen': 18, 'SS Glass': 0.55, 'DS Glass': 0.60, 'Plexiglass': 0.75 } }
      ];

      function nearestSize(rawW, rawH) {
        return SET_SIZES.reduce((best, s) => {
          const dBest = Math.hypot(best.w - rawW, best.h - rawH);
          const dCurr = Math.hypot(s.w - rawW, s.h - rawH);
          return dCurr < dBest ? s : best;
        });
      }

      const screensContainer = document.getElementById('screens-container');
      const template = document.getElementById('screen-template');
      const sumQty = document.getElementById('summary-quantity');
      const sumScr = document.getElementById('summary-screen-total');
      const sumLab = document.getElementById('summary-labor');
      const sumTax = document.getElementById('summary-tax');
      const sumGrand = document.getElementById('summary-grand');

      function updateSummary() {
        let qtySum = 0, screenTotal = 0, laborTotal = 0;
        screensContainer.querySelectorAll('.screen-group').forEach(grp => {
          const ttl = parseFloat(grp.querySelector('.total-price').textContent.split('$')[1]) || 0;
          const q = parseInt(grp.querySelector('[name="quantity"]').value) || 0;
          const lr = parseFloat(grp.dataset.labor) || 0;
          qtySum += q;
          screenTotal += ttl;
          laborTotal += lr * q;
        });
        const tax = screenTotal * TAX_RATE;
        sumQty.textContent = `Total Screens: ${qtySum}`;
        sumScr.textContent = `Screen Total: $${screenTotal.toFixed(2)}`;
        sumLab.textContent = `Labor Charge: $${laborTotal.toFixed(2)}`;
        sumTax.textContent = `Tax: $${tax.toFixed(2)}`;
        sumGrand.textContent = `Grand Total: $${(screenTotal + laborTotal + tax).toFixed(2)}`;
      }

      function updatePrices(grp) {
        const rawW = parseFloat(grp.querySelector('[name="screenWidth"]').value) || 0;
        const rawH = parseFloat(grp.querySelector('[name="screenHeight"]').value) || 0;
        const match = nearestSize(rawW, rawH);
        grp.querySelector('[name="screenWidth"]').value = match.w;
        grp.querySelector('[name="screenHeight"]').value = match.h;
        grp.dataset.labor = match.labor;

        const qty = parseInt(grp.querySelector('[name="quantity"]').value) || 0;
        const mat = grp.querySelector('[name="material"]').value;
        const unitCost = match.prices[mat] || 0;
        grp.querySelector('.unit-price').textContent = `Unit: $${unitCost.toFixed(2)}`;
        grp.querySelector('.total-price').textContent = `Total: $${(unitCost * qty).toFixed(2)}`;
        updateSummary();
      }

      function attachEvents(grp) {
        if (!grp) return;
        ['screenWidth','screenHeight','quantity'].forEach(name => {
          const el = grp.querySelector(`[name="${name}"]`);
          if (el) el.addEventListener('input', () => updatePrices(grp));
        });
        const matEl = grp.querySelector('[name="material"]');
        if (matEl) matEl.addEventListener('change', () => updatePrices(grp));
        const remBtn = grp.querySelector('.remove-btn');
        if (remBtn) remBtn.addEventListener('click', () => {
          if (screensContainer.children.length > 1) { grp.remove(); updateSummary(); }
        });
        updatePrices(grp);
      }

      // Initialize template
      attachEvents(template);

      document.getElementById('add-screen').onclick = () => {
        const clone = template.cloneNode(true);
        clone.removeAttribute('id');
        screensContainer.append(clone);
        attachEvents(clone);
      };

      document.getElementById('repairForm').addEventListener('submit', e => {
        e.preventDefault();
        // Final output generation logic...
      });
    });
  </script>
</body>
</html>
